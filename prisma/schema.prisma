generator client {
  provider      = "prisma-client-js"
  output        = "./generated/client"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String               @id @default(uuid())
  username     String               @unique
  email        String               @unique
  password     String
  first_name   String               @default("")
  last_name    String               @default("")
  gender       Gender               @relation(fields: [genderId], references: [id])
  genderId     Int                  @default(3)
  avatar       String               @default("")
  country      String               @default("")
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  isBanned     Boolean              @default(false)
  role         UserRole[]
  provider     Provider?
  following    Following[]
  Banned       Bans[]
  books        UserBooks[]
  shelfs       Shelf[]
  reviews      Reviews[]
  reviewsLikes ReviewsLikeDislike[]
  token        Token[]
}

enum UserRole {
  ADMIN
  USER
}

enum Provider {
  GOOGLE
  FACEBOOK
}

model Token {
  token     String   @unique
  exp       DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  userAgent String
}

model ResetPassword {
  id        String   @id @default(uuid())
  email     String
  token     String
  createdAt DateTime @default(now())
}

model Shelf {
  id     String       @id @default(uuid())
  name   String
  user   User         @relation(fields: [userId], references: [id])
  userId String
  books  ShelfBooks[]
}

model ShelfBooks {
  shelf   Shelf  @relation(fields: [shelfId], references: [id])
  shelfId String
  book    Book   @relation(fields: [bookId], references: [id])
  bookId  String

  @@id([bookId, shelfId])
}

model Gender {
  id   Int    @id @default(autoincrement())
  name String
  user User[]
}

model Following {
  id          String @id @default(uuid())
  userId      String
  following   User   @relation(fields: [userId], references: [id])
  followingId String
}

model Bans {
  id         String    @id @default(uuid())
  user       User      @relation(fields: [userId], references: [id])
  userId     String
  bannedAt   DateTime  @default(now())
  unbannedAt DateTime?
  reason     String
}

model UserBooks {
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  book      Book     @relation(fields: [bookId], references: [id])
  bookId    String
  status    Status   @relation(fields: [statusId], references: [id])
  statusId  Int
  addedAt   DateTime @default(now())
  readEndAt DateTime

  @@id([bookId, userId])
}

model Status {
  id          Int         @id @default(autoincrement())
  description String      @unique
  userBooks   UserBooks[]
}

model Reviews {
  id        String               @id @default(uuid())
  book      Book                 @relation(fields: [bookId], references: [id])
  bookId    String
  user      User                 @relation(fields: [userId], references: [id])
  userId    String
  rating    Int
  title     String
  body      String
  createdAt DateTime
  likes     ReviewsLikeDislike[]
}

model ReviewsLikeDislike {
  id       Int     @id @default(autoincrement())
  reviev   Reviews @relation(fields: [reviewId], references: [id])
  reviewId String
  user     User    @relation(fields: [userId], references: [id])
  userId   String
  isLike   Boolean
}

model Book {
  id                 String       @id @default(uuid())
  title              String       @unique
  authors            BookAuthor[]
  genres             BookGenres[]
  isbn               String       @unique
  publicationDate    DateTime
  numberOfPages      Int
  language           String
  image              String
  description        String
  publisher          Publisher    @relation(fields: [publisherId], references: [id])
  publisherId        String
  publicationCountry String
  binding            Binding      @relation(fields: [bindingId], references: [id])
  bindingId          Int
  awards             BookAwards[]
  users              UserBooks[]
  shelfs             ShelfBooks[]
  reviews            Reviews[]
}

model Awards {
  id          String       @id @default(uuid())
  name        String
  description String
  date        DateTime
  books       BookAwards[]
}

model BookAwards {
  book     Book   @relation(fields: [bookId], references: [id])
  bookId   String
  award    Awards @relation(fields: [awardsId], references: [id])
  awardsId String

  @@id([bookId, awardsId])
}

model Binding {
  id   Int    @id @default(autoincrement())
  name String
  book Book[]
}

model Publisher {
  id      String @id @default(uuid())
  name    String @unique
  books   Book[]
  Country String
}

model Genre {
  id          String       @id @default(uuid())
  name        String       @unique
  description String
  books       BookGenres[]
  parentId    Int?
  children    Genre[]      @relation("genre-hierarchy")
  parent      Genre?       @relation("genre-hierarchy", fields: [genreId], references: [id])
  genreId     String?
}

model BookGenres {
  book    Book   @relation(fields: [bookId], references: [id])
  bookId  String
  genre   Genre  @relation(fields: [genreId], references: [id])
  genreId String

  @@id([bookId])
}

model Author {
  id          String       @id @default(uuid())
  books       BookAuthor[]
  firstName   String
  lastName    String
  dateOfBirth DateTime
  country     String
  image       String
  bio         String
}

model BookAuthor {
  book     Book   @relation(fields: [bookId], references: [id])
  bookId   String
  author   Author @relation(fields: [authorId], references: [id])
  authorId String

  @@id([bookId, authorId])
}

model News {
  id          String   @id @default(uuid())
  title       String   @unique
  description String
  date        DateTime
}
